<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <title>Kết quả tìm kiếm</title>
  <th:block th:replace="~{layout :: link-css}"></th:block>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/custom_js.js"></script>
  <style>
    .avatar-image {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
    }
    .post-images img {
      max-width: 100px; /* Example size for post images */
      max-height: 100px; /* Example size for post images */
      object-fit: cover;
      margin-right: 5px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
<header th:replace="~{layout :: header}"></header>

<main layout:fragment="content">
  <h1>Kết quả tìm kiếm</h1>

  <div th:if="${users.size() > 0}">
    <h2>Người dùng</h2>
    <ul>
      <li th:each="user : ${users}">
        <a th:href="@{/profile(userId=${user.id})}">
          <img th:if="${user.image != null}"
               th:src="'data:image/jpeg;base64,' + ${user.getBase64Image()}"
               class="avatar-image" alt="Avatar" />
          <span th:text="${user.name}"></span>
        </a>
        <!-- Friend request button -->
        <button class="friend-request-btn" th:data-friend-id="${user.id}">Kết bạn</button>
      </li>
    </ul>
  </div>

  <!-- User posts list -->
  <div th:if="${not #lists.isEmpty(userPosts)}">
    <h2>Recent User Posts</h2>
    <div th:each="userPost : ${userPosts}" class="card mb-3">
      <div class="card-body">
        <h5 class="card-title" th:text="${userPost.user.name}"></h5>
        <h6 class="card-subtitle mb-2 text-muted" th:text="${#dates.format(userPost.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></h6>
        <p class="card-text" th:text="${userPost.content}"></p>
        <p>Class: <span th:text="${userPost.classEntity.name}"></span></p>
        <p>Subject: <span th:text="${userPost.subjectEntity.name}"></span></p>
        <div class="post-images">
          <img th:each="image : ${userPost.images}" th:src="'data:' + ${image.type} + ';base64,' + ${@base64EncoderUtil.encodeToString(image.data)}" />
        </div>
        <span class="like-count" th:text="${userPost.likes}"></span>
        <p>Comments: <span th:text="${userPost.commentCount}"></span></p>
        <button type="button" class="btn btn-primary like-btn" th:data-post-id="${userPost.id}"
                th:text="${#lists.contains(userPost.userPostLikes, #authentication.principal.id) ? 'Unlike' : 'Like'}">
        </button>
        <a th:href="@{/user-posts/{id}(id=${userPost.id})}" class="btn btn-secondary">Comments</a>
        <form th:action="@{/user-posts/{id}/report(id=${userPost.id})}" method="post" class="d-inline">
          <input type="text" name="reason" placeholder="Reason for reporting" required>
          <button type="submit" class="btn btn-warning">Report Post</button>
        </form>
        <form th:if="${#lists.contains(followedPosts, userPost)}"
              th:action="@{/user-posts/{id}/unfollow(id=${userPost.id})}" method="post" class="d-inline">
          <button type="submit" class="btn btn-info">Unfollow</button>
        </form>
        <form th:unless="${#lists.contains(followedPosts, userPost)}"
              th:action="@{/user-posts/{id}/follow(id=${userPost.id})}" method="post" class="d-inline">
          <button type="submit" class="btn btn-info">Follow</button>
        </form>
      </div>
    </div>
  </div>
  <div th:if="${#lists.isEmpty(userPosts)}">
    <p>No posts found.</p>
  </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>
</body>
</html>
